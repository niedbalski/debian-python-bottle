<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Docs - Bottle Web Framework</title>
  <link type="text/css" rel="stylesheet" href="/main.css" />
  <link type="text/css" rel="stylesheet" href="/pygments.css" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
</head>
<body>
<div id="navigation">
  <h1>Pages</h1>
  <ul>
    <li><a href="/">Home</a></li>
    <li><a href="/page/docs">Documentation</a></li>
  </ul>
  <h1>Links</h1>
  <ul>
    <li><a target="_blank" href="http://pypi.python.org/pypi/bottle">Download</a></li>
    <li><a target="_blank" href="http://github.com/defnull/bottle">GitHub Repository</a></li>
    <li><a target="_blank" href="http://github.com/defnull/bottle/issues">Issue Tracker</a></li>
    <li><a target="_blank" href="http://groups.google.de/group/bottlepy">Google Groups</a></li>
    <li><a target="_blank" href="http://twitter.com/bottlepy">Twitter</a></li>
  </ul>
</div>
<div id='mdpage'>
<div class="toc">
<ul>
<li><a href="#bottle-documentation">Bottle Documentation</a><ul>
<li><a href="#hello-world-in-a-bottle">"Hello World" in a Bottle</a></li>
</ul>
</li>
<li><a href="#routing">Routing</a><ul>
<li><a href="#request-methods">Request Methods</a></li>
<li><a href="#dynamic-routes">Dynamic Routes</a><ul>
<li><a href="#regular-expressions">Regular Expressions</a></li>
</ul>
</li>
<li><a href="#the-validate-decorator">The @validate() decorator</a></li>
</ul>
</li>
<li><a href="#generating-content">Generating content</a><ul>
<li><a href="#output-casting">Output Casting</a><ul>
<li><a href="#strings-and-unicode">Strings and Unicode</a></li>
<li><a href="#file-objects-and-streams">File Objects and Streams</a></li>
<li><a href="#json">JSON</a></li>
<li><a href="#static-files">Static Files</a></li>
</ul>
</li>
<li><a href="#http-errors-and-redirects">HTTP Errors and Redirects</a></li>
</ul>
</li>
<li><a href="#http-stuff">HTTP Stuff</a><ul>
<li><a href="#cookies">Cookies</a></li>
<li><a href="#get-and-post-values">GET and POST values</a></li>
</ul>
</li>
<li><a href="#templates">Templates</a><ul>
<li><a href="#template-search-path">Template search path</a></li>
<li><a href="#template-caching">Template caching</a></li>
<li><a href="#template-syntax">Template Syntax</a></li>
</ul>
</li>
<li><a href="#keyvalue-databases">Key/Value Databases</a><ul>
<li><a href="#persistence">Persistence</a></li>
<li><a href="#race-conditions">Race conditions</a></li>
<li><a href="#example">Example</a></li>
</ul>
</li>
<li><a href="#using-wsgi-and-middleware">Using WSGI and Middleware</a><ul>
<li><a href="#how-default_app-works">How default_app() works</a></li>
</ul>
</li>
<li><a href="#development">Development</a><ul>
<li><a href="#debug-mode">Debug Mode</a></li>
<li><a href="#auto-reloading">Auto Reloading</a></li>
</ul>
</li>
<li><a href="#deployment">Deployment</a><ul>
<li><a href="#multi-threaded-server">Multi-Threaded Server</a></li>
<li><a href="#multiple-server-processes">Multiple Server Processes</a></li>
<li><a href="#apache-mod_wsgi">Apache mod_wsgi</a></li>
<li><a href="#google-appengine">Google AppEngine</a></li>
<li><a href="#good-old-cgi">Good old CGI</a></li>
</ul>
</li>
</ul>
</div>
<h1 id="bottle-documentation">Bottle Documentation</h1>
<p><strong>This document is a work in progress</strong> and intended to be a tutorial, howto and an api documentation at the same time. If you have questions not answered here,
please file a ticket at bottles <a href="http://github.com/defnull/bottle/issues">issue tracker</a>.</p>
<h2 id="hello-world-in-a-bottle">"Hello World" in a Bottle</h2>
<p>Lets start with a very basic example: Hello World</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">run</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span>
<span class="n">run</span><span class="p">()</span> <span class="c"># This starts the HTTP server</span>
</pre></div>
</td></tr></table>

<p>Run this script, visit <a href="http://localhost:8080/hello">http://localhost:8080/hello</a> and you will see "Hello World!" in your Browser. So, what happened here?</p>
<ol>
<li>First we imported some bottle components. The <code>route()</code> decorator and the <code>run()</code> function. </li>
<li>The <code>route()</code> <a href="http://docs.python.org/glossary.html#term-decorator">decorator</a> is used do bind a piece of code to an URL. In this example we want to answer requests to the <code>/hello</code> URL.</li>
<li>This function will be called every time someone hits the <code>/hello</code> URL on the web server. It is called a <strong>handler function</strong>.</li>
<li>The return value of a handler function will be sent back to the Browser.</li>
<li>Now it is time to start the actual HTTP server. The default is a development server running on <em>localhost</em> port <em>8080</em> and serving requests until you hit <strong>Ctrl-C</strong></li>
</ol>
<h1 id="routing">Routing</h1>
<p>Routes are used to map URLs to <strong>handler callbacks</strong> that generate the content for the specific URL. Bottle has a <code>route()</code> decorator to do that. You can add any number of routes to a callback.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/index.html&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;&lt;a href=&#39;/hello&#39;&gt;Go to Hello World page&lt;/a&gt;&quot;</span>

<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/hello&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span>
</pre></div>
</td></tr></table>

<p>As you can see, URLs and routes have nothing to do with actual files on the web server. Routes are unique names for your handler callbacks, nothing more and nothing less.</p>
<p>URLs not matching any routes are answered by a 404 error. Exceptions within your handler callbacks will cause 500 errors. </p>
<h2 id="request-methods">Request Methods</h2>
<p>The <code>route()</code> decorator has an optional keyword argument <code>method</code> which defaults to <code>method='GET'</code>, so only GET requests get answered.
Possible values are <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>HEAD</code> or any other <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">HTTP request method</a> you want to listen to.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">request</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/form/submit&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;POST&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">form_submit</span><span class="p">():</span>
    <span class="n">form_data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span> <span class="c"># see &quot;GET and POST values&quot;</span>
    <span class="n">do_something_with</span><span class="p">(</span><span class="n">form_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;Done&quot;</span>
</pre></div>
</td></tr></table>

<p>In this example we used <code>request.POST</code> which is described <a href="#get-and-post-values">here</a></p>
<h2 id="dynamic-routes">Dynamic Routes</h2>
<p>Static routes are fine, but URLs may carry information as well. Let's add a <code>:name</code> placeholder to our route.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/hello/:name&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;Hello </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">name</span>
</pre></div>
</td></tr></table>

<p>This dynamic route matches <code>/hello/alice</code> as well as <code>/hello/bob</code>. In fact, the <code>:name</code> part of the route matches everything but a slash (<code>/</code>), so any name is possible. <code>/hello/bob/and/alice</code> or <code>/hellobob</code> won't match.</p>
<p>Each part of the URL covered by a placeholder is provided to your handler callback as a keyword parameter.</p>
<h3 id="regular-expressions">Regular Expressions</h3>
<p>The default placeholder matches everything up to the next slash. To change that, you can add some regular expression:</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/get_object/:id#[0-9]+#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;Object ID: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>or even use full featured regular expressions with named groups:</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/get_object/(?P&lt;id&gt;[0-9]+)&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;Object ID: </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">int</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>As you can see, URL parameters remain strings, even if they are 
configured to only match digits. You have to explicitly cast them into 
the type you need.</p>
<h2 id="the-validate-decorator">The @validate() decorator</h2>
<p>Bottle offers a handy decorator called <code>validate()</code> to check and manipulate URL parameters.
It takes callables (function or class objects) as keyword arguments and filters every URL parameter 
through the corresponding callable before they are passed to your request handler.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">validate</span>
<span class="c"># /test/validate/1/2.3/4,5,6,7</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/test/validate/:i/:f/:csv&#39;</span><span class="p">)</span>
<span class="nd">@validate</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">csv</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)))</span>
<span class="k">def</span> <span class="nf">validate_test</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">csv</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;Int: </span><span class="si">%d</span><span class="s">, Float:</span><span class="si">%f</span><span class="s">, List:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">csv</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>You may raise <code>ValueError</code> in your custom callable if a parameter 
does not validate.</p>
<h1 id="generating-content">Generating content</h1>
<p>TODO</p>
<h2 id="output-casting">Output Casting</h2>
<p>The <a href="http://www.wsgi.org/wsgi/">WSGI specification</a> expects an iterable list of byte strings to be returned from your application and can't handle file objects, unicode, dictionaries or exceptions.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/wsgi&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wsgi</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">[</span><span class="s">&#39;WSGI&#39;</span><span class="p">,</span><span class="s">&#39;wants a&#39;</span><span class="p">,</span><span class="s">&#39;list of&#39;</span><span class="p">,</span><span class="s">&#39;strings&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table>

<p>Bottle automatically tries to convert anything to a WSGI supported type, so you
don't have to. The following examples will work with Bottle, but won't work with
pure WSGI.</p>
<h3 id="strings-and-unicode">Strings and Unicode</h3>
<p>Returning strings (bytes) is not a problem. Unicode however needs to be encoded into a byte stream before 
the webserver can send it to the client. Ths default encoding is utf-8, so if that fits your needs, you can 
simply return unicode or unicode iterables.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">response</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/string&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_string</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">&#39;Bottle converts strings to iterables&#39;</span>

<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/unicode&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_unicode</span><span class="p">():</span>
    <span class="k">return</span> <span class="s">u&#39;Unicode is encoded with UTF-8 by default&#39;</span>
</pre></div>
</td></tr></table>

<p>You can change Bottles default encoding by setting <code>response.content_type</code> to a value 
containing a <code>charset=...</code> parameter or by changing <code>response.charset</code> directly.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">response</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/iso&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_iso</span><span class="p">():</span>
    <span class="n">response</span><span class="o">.</span><span class="n">charset</span> <span class="o">=</span> <span class="s">&#39;ISO-8859-15&#39;</span>
    <span class="k">return</span> <span class="s">u&#39;This will be sent with ISO-8859-15 encoding.&#39;</span>

<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/latin9&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_latin</span><span class="p">():</span>
    <span class="n">response</span><span class="o">.</span><span class="n">content_type</span> <span class="o">=</span> <span class="s">&#39;text/html; charset=latin9&#39;</span>
    <span class="k">return</span> <span class="s">u&#39;ISO-8859-15 is also known as latin9.&#39;</span>
</pre></div>
</td></tr></table>

<p>In some rare cases the Python encoding names differ from the names supported by the HTTP specification. 
Then, you have to do both: First set the <code>response.content_type</code> header (which is sent to the client 
unchanged) and then set the <code>response.charset</code> option (which is used to decode unicode).</p>
<h3 id="file-objects-and-streams">File Objects and Streams</h3>
<p>Bottle wrapps everything that has a <code>read()</code> method (file objects) with the <code>wsgi.file_wrapper</code> 
provided by your WSGI server implementation. This wrapper should use highly optimised system calls for 
your operating system (<code>sendfile</code> on UNIX) to transfer the file.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="codehilite"><pre><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/file&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">get_file</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;some/file.txt&#39;</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h3 id="json">JSON</h3>
<p>Even dictionaries are allowed. They are converted to
<a href="http://de.wikipedia.org/wiki/JavaScript_Object_Notation">json</a> and returned
with <code>Content-Type</code> header set to <code>application/json</code>. To disable this feature (and pass dicts to your 
middleware) you can set <code>bottle.default_app().autojson</code> to <code>False</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="codehilite"><pre><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/api/status&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">api_status</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;status&#39;</span><span class="p">:</span><span class="s">&#39;online&#39;</span><span class="p">,</span> <span class="s">&#39;servertime&#39;</span><span class="p">:</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()}</span>
</pre></div>
</td></tr></table>

<h3 id="static-files">Static Files</h3>
<p>You can directly return file objects, but <code>bottle.send_file()</code> is the recommended way to serve static files. 
It automatically guesses a mime-type, adds a <code>Last-Modified</code> header, restricts paths to a <code>root</code> directory 
for security reasons and generates appropriate error pages (401 on permission errors, 404 on missing files). It 
even supports the <code>If-Modified-Since</code> header and eventually generates a <code>304 Not modified</code> response.
You can pass a custom mimetype to disable mimetype guessing.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">send_file</span>

<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/static/:filename&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">static_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">send_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s">&#39;/path/to/static/files&#39;</span><span class="p">)</span>

<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/images/:filename#.*\.png#&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">static_image</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">send_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="s">&#39;/path/to/image/files&#39;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s">&#39;image/png&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="http-errors-and-redirects">HTTP Errors and Redirects</h2>
<p>The <code>bottle.abort(code[, message])</code> function is used to generate <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html">HTTP error pages</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">abort</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/restricted&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">restricted</span><span class="p">():</span>
    <span class="n">abort</span><span class="p">(</span><span class="mf">401</span><span class="p">,</span> <span class="s">&quot;Sorry, access denied.&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>To redirect a client to a different URL, you can send a <code>307 Temporary Redirect</code> response
with the <code>Location</code> header set to the new URL. <code>bottle.redirect(url[, code])</code> does that for you.
You may provide a different HTTP status code as a second parameter.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">abort</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/wrong/url&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">wrong</span><span class="p">():</span>
    <span class="n">redirect</span><span class="p">(</span><span class="s">&quot;/right/url&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Both functions interrupt your handler code (by throwing a <code>bottle.HTTPError</code> exception) so you don't 
have to return anything.</p>
<p>All unhandled exceptions other than <code>bottle.HTTPError</code> will result in a <code>500 Internal Server Error</code> 
response, so they won't crash your WSGI server. </p>
<h1 id="http-stuff">HTTP Stuff</h1>
<p>TODO</p>
<h2 id="cookies">Cookies</h2>
<p>Bottle stores cookies sent by the client in a dictionary called <code>request.COOKIES</code>. To create new cookies,
the method <code>response.set_cookie(name, value[, **params])</code> is used. It accepts additional parameters as long as they are valid 
cookie attributes supported by <a href="http://docs.python.org/library/cookie.html#morsel-objects">SimpleCookie</a>.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">response</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="s">&#39;key&#39;</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s">&#39;example.com&#39;</span><span class="p">,</span> <span class="n">secure</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">expires</span><span class="o">=+</span><span class="mf">500</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>To set the <code>max-age</code> attribute (which is not a valid Python parameter name) you can directly access an instance of 
<a href="http://docs.python.org/library/cookie.html#Cookie.SimpleCookie">cookie.SimpleCookie</a> in <code>response.COOKIES</code>. </p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">response</span>
<span class="n">response</span><span class="o">.</span><span class="n">COOKIES</span><span class="p">[</span><span class="s">&#39;key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;value&#39;</span>
<span class="n">response</span><span class="o">.</span><span class="n">COOKIES</span><span class="p">[</span><span class="s">&#39;key&#39;</span><span class="p">][</span><span class="s">&#39;max-age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">500</span>
</pre></div>
</td></tr></table>

<h2 id="get-and-post-values">GET and POST values</h2>
<p>TODO</p>
<h1 id="templates">Templates</h1>
<p>Bottle uses its own little template engine by default. You can use a template by
calling <code>template(template_name, **template_arguments)</code> and returning
the result.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="codehilite"><pre><span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/hello/:name&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">template</span><span class="p">(</span><span class="s">&#39;hello_template&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>This will load the template <code>hello_template.tpl</code> with the <code>username</code> variable set to the URL <code>:name</code> part and return the result as a string.</p>
<p>The <code>hello_template.tpl</code> file could look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="codehilite"><pre><span class="nt">&lt;h1&gt;</span>Hello {{username}}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>How are you?<span class="nt">&lt;/p&gt;</span>
</pre></div>
</td></tr></table>

<h2 id="template-search-path">Template search path</h2>
<p>The list <code>bottle.TEMPLATE_PATH</code> is used to map template names to actual 
file names. By default, this list contains <code>['./%s.tpl', './views/%s.tpl']</code>.</p>
<h2 id="template-caching">Template caching</h2>
<p>Templates are cached in memory after compilation. Modifications made to 
the template file will have no affect until you clear the template 
cache. Call <code>bottle.TEMPLATES.clear()</code> to do so.</p>
<h2 id="template-syntax">Template Syntax</h2>
<p>The template syntax is a very thin layer around the Python language. 
It's main purpose is to ensure correct indention of blocks, so you 
can format your template without worrying about indentions. Here is the 
complete syntax description:</p>
<ul>
<li><code>%...</code> starts a line of python code. You don't have to worry about indentions. Bottle handles that for you.</li>
<li><code>%end</code> closes a Python block opened by <code>%if ...</code>, <code>%for ...</code> or other block statements. Explicitly closing of blocks is required.</li>
<li><code>{{...}}</code> prints the result of the included python statement.</li>
<li><code>%include template_name optional_arguments</code> allows you to include other templates.</li>
<li>Every other line is returned as text.</li>
</ul>
<p>Example:</p>
<table class="codehilitetable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></td><td class="code"><div class="codehilite"><pre>%header = &#39;Test Template&#39;
%items = [1,2,3,&#39;fly&#39;]
%include http_header title=header, use_js=[&#39;jquery.js&#39;, &#39;default.js&#39;]
<span class="nt">&lt;h1&gt;</span>{{header.title()}}<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
%for item in items:
  <span class="nt">&lt;li&gt;</span>
    %if isinstance(item, int):
      Zahl: {{item}}
    %else:
      %try:
        Other type: ({{type(item).__name__}}) {{repr(item)}}
      %except:
        Error: Item has no string representation.
      %end try-block (yes, you may add comments here)
    %end
    <span class="nt">&lt;/li&gt;</span>
  %end
<span class="nt">&lt;/ul&gt;</span>
%include http_footer
</pre></div>
</td></tr></table>

<h1 id="keyvalue-databases">Key/Value Databases</h1>
<div style="color:darkred">Warning: The included key/value database is depreciated.</div>

<p>Please switch to a <a href="http://code.google.com/p/redis/">real</a> <a href="http://couchdb.apache.org/">key</a> <a href="http://www.mongodb.org/">value</a> <a href="http://docs.python.org/library/anydbm.html">database</a>.</p>
<p>Bottle (&gt;0.4.6) offers a persistent key/value database accessible through the
<code>bottle.db</code> module variable. You can use key or attribute syntax to store or
fetch any pickle-able object to the database. Both 
<code>bottle.db.bucket_name.key_name</code> and <code>bottle.db[bucket_name][key_name]</code> 
will work.</p>
<p>Missing buckets are created on demand. You don't have to check for 
their existence before using them. Just be sure to use alphanumeric 
bucket-names.</p>
<p>The bucket objects behave like mappings (dictionaries), except that 
only strings are allowed for keys and values must be pickle-able. 
Printing a bucket object doesn't print the keys and values, and the 
<code>items()</code> and <code>values()</code> methods are not supported. Missing keys will raise 
<code>KeyError</code> as expected.</p>
<h2 id="persistence">Persistence</h2>
<p>During a request live-cycle, all changes are cached in thread-local memory. At
the end of the request, the changes are saved automatically so the next request
will have access to the updated values. Each bucket is stored in a separate file
in <code>bottle.DB_PATH</code>. Be sure to allow write-access to this path and use bucket
names that are allowed in filenames.</p>
<h2 id="race-conditions">Race conditions</h2>
<p>You don't have do worry about file corruption but race conditions are still a
problem in multi-threaded or forked environments. You can call
<code>bottle.db.save()</code> or <code>botle.db.bucket_name.save()</code> to flush the thread-local
memory cache to disk, but there is no way to detect database changes made in
other threads until these threads call <code>bottle.db.save()</code> or leave the current
request cycle.</p>
<h2 id="example">Example</h2>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">route</span><span class="p">,</span> <span class="n">db</span>
<span class="nd">@route</span><span class="p">(</span><span class="s">&#39;/db/counter&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">db_counter</span><span class="p">():</span>
    <span class="k">if</span> <span class="s">&#39;hits&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">counter</span><span class="p">:</span>
        <span class="n">db</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">hits</span> <span class="o">=</span> <span class="mf">0</span>
    <span class="n">db</span><span class="p">[</span><span class="s">&#39;counter&#39;</span><span class="p">][</span><span class="s">&#39;hits&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mf">1</span>
    <span class="k">return</span> <span class="s">&quot;Total hits: </span><span class="si">%d</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">db</span><span class="o">.</span><span class="n">counter</span><span class="o">.</span><span class="n">hits</span>
</pre></div>
</td></tr></table>

<h1 id="using-wsgi-and-middleware">Using WSGI and Middleware</h1>
<p>A call to <code>bottle.default_app()</code> returns your WSGI application. After applying as many WSGI middleware modules as you like, you can tell 
<code>bottle.run()</code> to use your wrapped application, instead of the default one.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">default_app</span><span class="p">,</span> <span class="n">run</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">default_app</span><span class="p">()</span>
<span class="n">newapp</span> <span class="o">=</span> <span class="n">YourMiddleware</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">newapp</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="how-default_app-works">How default_app() works</h2>
<p>Bottle creates a single instance of <code>bottle.Bottle()</code> and uses it as a default for most of the modul-level decorators and the <code>bottle.run()</code> routine. 
<code>bottle.default_app()</code> returns (or changes) this default. You may, however, create your own instances of <code>bottle.Bottle()</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">Bottle</span><span class="p">,</span> <span class="n">run</span>
<span class="n">mybottle</span> <span class="o">=</span> <span class="n">Bottle</span><span class="p">()</span>
<span class="nd">@mybottle</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
  <span class="k">return</span> <span class="s">&#39;default_app&#39;</span>
<span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="o">=</span><span class="n">mybottle</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h1 id="development">Development</h1>
<p>Bottle has two features that may be helpfull during development.</p>
<h2 id="debug-mode">Debug Mode</h2>
<p>In debug mode, bottle is much more verbose and tries to help you finding 
bugs. You should never use debug mode in production environments.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">import</span> <span class="nn">bottle</span>
<span class="n">bottle</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>This does the following:</p>
<ul>
<li>Exceptions will print a stacktrace</li>
<li>Error pages will contain that stacktrace</li>
<li>Templates will not be cached.</li>
</ul>
<h2 id="auto-reloading">Auto Reloading</h2>
<p>During development, you have to restart the server a lot to test your 
recent changes. The auto reloader can do this for you. Every time you 
edit a module file, the reloader restarts the server process and loads 
the newest version of your code. </p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">run</span>
<span class="n">run</span><span class="p">(</span><span class="n">reloader</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>How it works: The main process will not start a server, but spawn a new 
child process using the same command line agruments used to start the 
main process. All module level code is executed at least twice! Be 
carefull.</p>
<p>The child process will have <code>os.environ['BOTTLE_CHILD']</code> set to <code>true</code> 
and start as a normal non-reloading app server. As soon as any of the 
loaded modules changes, the child process is terminated and respawned by 
the main process. Changes in template files will not trigger a reload. 
Please use debug mode to deactivate template caching.</p>
<p>The reloading depends on the ability to stop the child process. If you are
running on Windows or any other operating system not supporting 
<code>signal.SIGINT</code> (which raises <code>KeyboardInterrupt</code> in Python), 
<code>signal.SIGTERM</code> is used to kill the child. Note that exit handlers and 
finally clauses, etc., are not executed after a <code>SIGTERM</code>.</p>
<h1 id="deployment">Deployment</h1>
<p>Bottle uses the build-in <code>wsgiref.SimpleServer</code> by default. This non-threading
HTTP server is perfectly fine for development and early production,
but may become a performance bottleneck when server load increases.</p>
<p>There are three ways to eliminate this bottleneck:</p>
<ul>
<li>Use a multi-threaded server adapter</li>
<li>Spread the load between multiple bottle instances</li>
<li>Do both</li>
</ul>
<h2 id="multi-threaded-server">Multi-Threaded Server</h2>
<p>The easiest way to increase performance is to install a multi-threaded and
WSGI-capable HTTP server like <a href="http://pythonpaste.org/">Paste</a>, <a href="http://trac.saddi.com/flup">flup</a>, <a href="http://www.cherrypy.org/">cherrypy</a>
or <a href="http://github.com/william-os4y/fapws3">fapws3</a> and use the corresponding bottle server-adapter.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">from</span> <span class="nn">bottle</span> <span class="kn">import</span> <span class="n">PasteServer</span><span class="p">,</span> <span class="n">FlupServer</span><span class="p">,</span> <span class="n">FapwsServer</span><span class="p">,</span> <span class="n">CherryPyServer</span>
<span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="n">PasteServer</span><span class="p">)</span> <span class="c"># Example</span>
</pre></div>
</td></tr></table>

<p>If bottle is missing an adapter for your favorite server or you want to tweak
the server settings, you may want to manually set up your HTTP server and use
<code>bottle.default_app()</code> to access your WSGI application.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4</pre></td><td class="code"><div class="codehilite"><pre><span class="k">def</span> <span class="nf">run_custom_paste_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="n">myapp</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">paste</span> <span class="kn">import</span> <span class="n">httpserver</span>
    <span class="n">httpserver</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">myapp</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h2 id="multiple-server-processes">Multiple Server Processes</h2>
<p>A single Python process can only utilise one CPU at a time, even if 
there are more CPU cores available. The trick is to balance the load 
between multiple independent Python processes to utilise all of your 
CPU cores.</p>
<p>Instead of a single Bottle application server, you start one instances 
of your server for each CPU core available using different local port 
(localhost:8080, 8081, 8082, ...). Then a high performance load 
balancer acts as a reverse proxy and forwards each new requests to 
a random Bottle processes, spreading the load between all available 
backed server instances. This way you can use all of your CPU cores and 
even spread out the load between different physical servers.</p>
<p>But there are a few drawbacks:</p>
<ul>
<li>You can't easily share data between multiple Python processes.</li>
<li>It takes a lot of memory to run several copies of Python and Bottle 
at the same time.</li>
</ul>
<p>One of the fastest load balancer available is <a href="http://www.apsis.ch/pound/">pound</a> but most common web servers have a proxy-module that can do the work just fine.</p>
<p>I'll add examples for <a href="http://www.lighttpd.net/">lighttpd</a> and 
<a href="http://www.apache.org/">Apache</a> web servers soon.</p>
<h2 id="apache-mod_wsgi">Apache mod_wsgi</h2>
<p>Instead of running your own HTTP server from within Bottle, you can 
attach Bottle applications to an <a href="http://www.apache.org/">Apache server</a> using 
<a href="http://code.google.com/p/modwsgi/">mod_wsgi</a> and Bottles WSGI interface.</p>
<p>All you need is an <code>app.wsgi</code> file that provides an 
<code>application</code> object. This object is used by mod_wsgi to start your 
application and should be a WSGI conform Python callable.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5
6
7
8
9</pre></td><td class="code"><div class="codehilite"><pre><span class="c"># File: /var/www/yourapp/app.wsgi</span>

<span class="c"># Change working directory so relative paths (and template lookup) work again</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span>

<span class="kn">import</span> <span class="nn">bottle</span>
<span class="c"># ... add or import your bottle app code here ...</span>
<span class="c"># Do NOT use bottle.run() with mod_wsgi</span>
<span class="n">application</span> <span class="o">=</span> <span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>The Apache configuration may look like this:</p>
<table class="codehilitetable"><tr><td class="linenos"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></td><td class="code"><div class="codehilite"><pre><span class="nt">&lt;VirtualHost</span> <span class="s">*</span><span class="nt">&gt;</span>
    <span class="nb">ServerName</span> example.com

    <span class="nb">WSGIDaemonProcess</span> yourapp <span class="k">user</span>=www-data <span class="k">group</span>=www-data processes=1 threads=5
    <span class="nb">WSGIScriptAlias</span> / <span class="sx">/var/www/yourapp/app.wsgi</span>

    <span class="nt">&lt;Directory</span> <span class="s">/var/www/yourapp</span><span class="nt">&gt;</span>
        <span class="nb">WSGIProcessGroup</span> yourapp
        <span class="nb">WSGIApplicationGroup</span> %{GLOBAL}
        <span class="nb">Order</span> deny,allow
        <span class="nb">Allow</span> from <span class="k">all</span>
    <span class="nt">&lt;/Directory&gt;</span>
<span class="nt">&lt;/VirtualHost&gt;</span>
</pre></div>
</td></tr></table>

<h2 id="google-appengine">Google AppEngine</h2>
<p>I didn't test this myself but several Bottle users reported that this 
works just fine.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3
4
5</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">import</span> <span class="nn">bottle</span>
<span class="kn">from</span> <span class="nn">google.appengine.ext.webapp</span> <span class="kn">import</span> <span class="n">util</span> 
<span class="c"># ... add or import your bottle app code here ...</span>
<span class="c"># Do NOT use bottle.run() with AppEngine</span>
<span class="n">util</span><span class="o">.</span><span class="n">run_wsgi_app</span><span class="p">(</span><span class="n">bottle</span><span class="o">.</span><span class="n">default_app</span><span class="p">())</span>
</pre></div>
</td></tr></table>

<h2 id="good-old-cgi">Good old CGI</h2>
<p>CGI is slow as hell, but it works.</p>
<table class="codehilitetable"><tr><td class="linenos"><pre>1
2
3</pre></td><td class="code"><div class="codehilite"><pre><span class="kn">import</span> <span class="nn">bottle</span>
<span class="c"># ... add or import your bottle app code here ...</span>
<span class="n">bottle</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">server</span><span class="o">=</span><span class="n">bottle</span><span class="o">.</span><span class="n">CGIServer</span><span class="p">)</span>
</pre></div>
</td></tr></table>
</div>
<div id='footer'>
<div>Powered by <a href="/"><img src="/bottle-sig.png" /></a></div>
<div>Browse sources at <a href="http://github.com/defnull/bottle">GitHub</a></div>
<div><a href="/page/contact"><small>Kontakt und Impressum</small></a></div>


</div>
</body>
</html>
